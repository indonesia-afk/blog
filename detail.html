<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detail Berita</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{--bg-light:#f9f9fb;--bg-dark:#121212;--text-light:#222;--text-dark:#eee;--card-light:#fff;--card-dark:#1e1e1e;--accent:#f7b500;--accent-gradient:linear-gradient(135deg,#ffd84d,#f7b500);}
    body{margin:0;font-family:'Poppins',sans-serif;background:var(--bg-light);color:var(--text-light);transition:.3s;}
    body.dark{background:var(--bg-dark);color:var(--text-dark);}

    header{display:flex;justify-content:space-between;align-items:center;padding:.6rem 1rem;backdrop-filter:blur(12px);background:rgba(255,255,255,.7);position:sticky;top:0;z-index:100;border-bottom:1px solid rgba(0,0,0,.05);}
    body.dark header{background:rgba(18,18,18,.8);border-bottom:1px solid rgba(255,255,255,.1);}
    header h2{margin:0;font-size:1.1rem;line-height:1.4;}

    .btn{display:inline-block;padding:.4rem .8rem;font-size:.8rem;border-radius:14px;background:var(--accent-gradient);color:#000;font-weight:600;cursor:pointer;text-decoration:none;box-shadow:0 4px 12px rgba(0,0,0,.25);transition:transform .2s;}
    .btn:hover{transform:scale(1.05);}

    .theme-toggle{position:fixed;bottom:12px;left:12px;z-index:2000;background:var(--card-light);border:none;border-radius:50%;width:40px;height:40px;font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,.2);}
    body.dark .theme-toggle{background:var(--card-dark);color:#fff;}

    main{padding:1.5rem;max-width:800px;margin:auto;}
    .card{background:var(--card-light);margin-bottom:1.2rem;border-radius:18px;padding:1.2rem;box-shadow:0 4px 12px rgba(0,0,0,.05);}
    body.dark .card{background:var(--card-dark);}
    .date{font-size:.85rem;color:#777;margin-bottom:.6rem;} body.dark .date{color:#aaa;}
    .detail-img{width:100%;max-width:700px;max-height:400px;border-radius:12px;margin:1rem auto;display:block;object-fit:cover;cursor:zoom-in;}

    footer{text-align:center;padding:1rem;font-size:.9rem;opacity:.7;}

    #lightbox{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;justify-content:center;align-items:center;z-index:2000;}
    #lightbox img{max-width:90%;max-height:90%;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.5);}
    #closeBtn{position:absolute;top:20px;right:30px;font-size:2rem;font-weight:bold;color:#fff;cursor:pointer;z-index:2100;}

    #loadingOverlay{position:fixed;inset:0;background:rgba(255,255,255,.85);display:none;flex-direction:column;align-items:center;justify-content:center;font-family:'Poppins',sans-serif;font-weight:500;color:#333;z-index:3000;}
    body.dark #loadingOverlay{background:rgba(18,18,18,.85);color:#eee;}
    .loader{border:4px solid #f3f3f3;border-top:4px solid var(--accent);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin-bottom:1rem;}
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

    #customModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:4000;}
    .modal-box{background:#fff!important;color:var(--text-light);padding:1.5rem;border-radius:16px;max-width:300px;width:90%;text-align:center;box-shadow:0 6px 18px rgba(0,0,0,.2);animation:fadeIn .3s ease;display:flex;flex-direction:column;align-items:center;justify-content:center;}
    body.dark .modal-box{background:#1e1e1e!important;color:var(--text-dark);}
    @keyframes fadeIn{from{opacity:0;transform:scale(.9);}to{opacity:1;transform:scale(1);}}
    .modal-box button{margin-top:1rem;align-self:center;}

    /* ===== Tambahan kecil untuk ikon dokumen ===== */
    .doc-title{margin-top:1.2rem;font-weight:600;font-size:.95rem;}
    .doc-item{margin-top:.6rem;display:flex;align-items:center;gap:.45rem;font-size:.95rem;transition:transform .2s ease;}
    .doc-item span{font-size:1.3rem;transition:transform .2s ease;}
    .doc-item:hover span{transform:scale(1.25);}
    .doc-item a{text-decoration:none;color:inherit;}
    .doc-item a:hover{color:var(--accent);}
    .pdf span{color:#d93025;}
    .word span{color:#2b579a;}
    .excel span{color:#217346;}
    .ppt span{color:#d24726;}
    .gdoc span{color:#4285f4;}
    .zip span{color:#6a1b9a;}
  </style>
</head>
<body>
  <header>
    <h2><a href="index.html" style="text-decoration:none;color:inherit;">t-o-m.my.id</a></h2>
    <a href="javascript:history.back()" class="btn">Kembali</a>
  </header>

  <button class="theme-toggle" id="themeToggle">‚òÄÔ∏è</button>
  <main id="detailContainer"></main>
  <footer>Hak Cipta ¬© 2025 t-o-m.my.id</footer>

  <div id="lightbox" onclick="this.style.display='none'">
    <span id="closeBtn" onclick="document.getElementById('lightbox').style.display='none'">&times;</span>
    <img id="lightbox-img">
  </div>

  <div id="loadingOverlay"><div class="loader"></div><p>Memuat konten...</p></div>

  <div id="customModal"><div class="modal-box"><p id="modalMessage">Pesan notifikasi</p><button onclick="closeModal()" class="btn">OK</button></div></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    const firebaseConfig={apiKey:"AIzaSyDEGklPNtv-LvKzSW0d3QZRo5DMLr1nY-Y",authDomain:"portal-berita-firebase.firebaseapp.com",projectId:"portal-berita-firebase",storageBucket:"portal-berita-firebase.firebasestorage.app",messagingSenderId:"598254123187",appId:"1:598254123187:web:9418bcbe0a00dda3c3d8c6"};
    const app=initializeApp(firebaseConfig);const db=getFirestore(app);

    const themeToggle=document.getElementById("themeToggle");
    if(themeToggle){themeToggle.addEventListener("click",()=>{document.body.classList.toggle("dark");localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");themeToggle.textContent=document.body.classList.contains("dark")?"üåô":"‚òÄÔ∏è";});if(localStorage.getItem("theme")==="dark"){document.body.classList.add("dark");themeToggle.textContent="üåô";}}

    function showLoading(){document.getElementById("loadingOverlay").style.display="flex";}
    function hideLoading(){document.getElementById("loadingOverlay").style.display="none";}
    window.showModal=(msg)=>{document.getElementById("modalMessage").textContent=msg;document.getElementById("customModal").style.display="flex";}
    window.closeModal=()=>{document.getElementById("customModal").style.display="none";}

    async function loadDetail(){
      const id=new URLSearchParams(window.location.search).get("id");
      if(!id){document.getElementById("detailContainer").innerHTML="‚ùå Tidak ada ID berita.";return;}
      showLoading();
      try{
        const snap=await getDoc(doc(db,"posts",id));
        hideLoading();
        if(!snap.exists()){document.getElementById("detailContainer").innerHTML="‚ùå Berita tidak ditemukan.";return;}
        const d=snap.data();
        if(d.status!=="Aktif"){document.getElementById("detailContainer").innerHTML="<div class='card'><p>Konten tidak tersedia.</p></div>";return;}

        let imageAtas="";let imageBawah="";
        if(d.images&&d.images.length>0){
          imageAtas=`<img src="${d.images[0]}" class="detail-img" onclick="showLightbox(this.src)">`;
          if(d.images.length>1){
            imageBawah=d.images.slice(1).map(url=>`<img src="${url}" class="detail-img" onclick="showLightbox(this.src)">`).join("");
          }
        }else if(d.imageUrl){
          imageAtas=`<img src="${d.imageUrl}" class="detail-img" onclick="showLightbox(this.src)">`;
        }

        // --- Dokumen Terkait (Peraturan) dengan warna ikon + efek hover ---
        let docSection="";
        if(d.category==="Peraturan" && Array.isArray(d.links) && d.links.length>0){
          const items=d.links.map(f=>{
            const url=f.url||"#";
            const name=f.name||"Dokumen";
            const lower=url.toLowerCase();
            let cls="";let icon="üìë";
            if(lower.includes(".pdf")){cls="pdf";icon="üìï";}
            else if(lower.includes(".doc")||lower.includes(".docx")){cls="word";icon="üìò";}
            else if(lower.includes(".xls")||lower.includes(".xlsx")){cls="excel";icon="üìä";}
            else if(lower.includes(".ppt")||lower.includes(".pptx")){cls="ppt";icon="üìà";}
            else if(lower.includes("docs.google.com")){cls="gdoc";icon="üìÑ";}
            else if(lower.includes(".zip")||lower.includes(".rar")){cls="zip";icon="üì¶";}
            return `<div class="doc-item ${cls}"><span>${icon}</span><a href="${url}" target="_blank">${name}</a></div>`;
          }).join("");
          docSection=`<div class="doc-title">Dokumen terkait:</div>${items}`;
        }

        document.getElementById("detailContainer").innerHTML=`
          <div class="card">
            ${imageAtas}
            <h2>${d.title}</h2>
            <div class="date">${d.createdAt?.toDate().toLocaleDateString("id-ID")||""}</div>
            <p>${d.content.replace(/\n/g,"<br>")}</p>
            ${docSection}
            ${imageBawah}
          </div>`;
      }catch(err){hideLoading();showModal("Gagal memuat detail: "+err.message);}
    }
    loadDetail();

    window.showLightbox=(src)=>{document.getElementById('lightbox-img').src=src;document.getElementById('lightbox').style.display='flex';}
  </script>
</body>
</html>
